<!DOCTYPE html>
<html lang="en">
  {% extends "sidebar.html" %}

  {% block content %}
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Solar Car Telemetry</title>

  <!-- Custom fonts for this template-->
  <link href="/node_modules/startbootstrap-sb-admin-2/vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
    type="text/css">
  <link href="{{ url_for('static', filename='css/sb-admin-2.css') }}" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="{{ url_for('static', filename='css/sb-admin-2.css') }}" rel="stylesheet">

</head>


<!-- Main Content -->
<div id="content">

  <!-- Topbar -->
  <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

    <img src="{{ url_for('static', filename='images/SolarCarTeamLogo.png') }}" height=80% />

  </nav>
  <!-- End of Topbar -->

  <!-- Begin Page Content -->
  <div class=row>
    <!-- Area Chart -->
    <div class="col-xl-11 col-lg-11 ml-4 mb-4">
      <div class="card shadow mb-4">
        <!-- Card Header - Dropdown -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">Battery Modules</h6>
          <div class="dropdown no-arrow">
            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
            </a>
          </div>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <table id="battery_module_table">
            <script>
              let table = document.getElementById("battery_module_table");
              let arr = [3, 3, 3, 3, 2, 2, 0, 2, 2, 3, 3, 3, 3];
              for(let i = 0; i < arr.length; i++){
                let row_parent = document.createElement("tr");
                table.appendChild(row_parent);
                if(arr[i] == 0){
                  let temp = document.createElement("td");
                  temp.className = "mrow";
                  row_parent.appendChild(temp);
                  row_parent.appendChild(document.createElement("td"));
                  row_parent.appendChild(document.createElement("td"));
                }
                for(let j = 0; j < arr[i]; j++){
                  let node = document.createElement("td");
                  node.id = "module" + i + "" + j;
                  node.className += "tdModule";
                  node.innerText = "0.00";
                  row_parent.appendChild(node);
                }
                table.appendChild(document.createElement("tr"));
              }
            </script>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!--Live Parameter Data-->
  <table class="table table-bordered table-dark">
    <thead>
      <tr>
        <th scope="col">Parameter</th>
        <th scope="col">Value</th>
        <th scope="col">Unit</th>
      </tr>
    </thead>
    <tbody id=battery_stats_table>
      <script>
        function htmlToElement(html) {
            var template = document.createElement('template');
            html = html.trim(); // Never return a text node of whitespace as the result
            template.innerHTML = html;
            return template.content.firstChild;
        }
        let namesArr = ["Average Battery Temperature", "Pack state of charge", "Pack discharge current limit", "Pack charge current limit", "Lowest cell voltage", "Highest cell voltage", "Highest battery temperature", "Lowest battery temperature", "Pack amperage (current)", "Pack voltage", "Pack amphours", "12v supply", "Run time"];
        let idsArr =   ["avg_temp", "soc", "discharge_limit", "charge_limit", "cell_voltage_lowest", "cell_voltage_highest", "bat_high_temp", "bat_low_temp", "pack_amperage", "pack_voltage", "pack_amphours", "twelveV_supply", "runTime"];
        let unitsArr = ["C", "%", "A", "A", "V", "V", "C", "C", "A", "V", "Ahr", "V", "Sec"];
        let statsTable = document.getElementById("battery_stats_table");
        for(let i = 0; i < namesArr.length; i++){          
          let tr = document.createElement("tr");
          tr.appendChild(htmlToElement('<th scope ="row">' + namesArr[i] + '</th>'));
          tr.appendChild(htmlToElement("<td id=" + idsArr[i] + ">0.0</td>"));
          tr.appendChild(htmlToElement("<td>" + unitsArr[i] + "</td>"));
          statsTable.appendChild(tr);
        }
      </script>
    </tbody>
  </table>
  <!-- /.container-fluid -->

</div>
<!-- End of Main Content -->

<!-- Footer -->
<footer class="sticky-footer bg-white">
  <div class="container my-auto">
    <div class="copyright text-center my-auto">
      <span>Copyright &copy; UVA Solar Car 2019</span>
    </div>
  </div>
</footer>
<!-- End of Footer -->
<!-- Page level plugins -->
<script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/soc-chart.js') }}"></script>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
{% endblock %}

</html>